---
date: 2023/11/10
---

<img src="https://i0.imgs.ovh/2023/11/14/n0JlW.jpeg" width="800" />

<small>封面图来源于海南三亚。在很久之前的团建去过一次，由于念念不忘那边的椰子鸡再去了一次，味道依旧不错，还偷师学会了做椰子鸡。</small>

**万宁神州半岛**  

<img src="https://i0.imgs.ovh/2023/11/14/n0tEJ.jpeg" width="800" />


## 技术分享-前端框架相关-渲染

## 渲染原理
引入一个重要的概念 Virtual DOM 

## Virtual DOM 
简单来说，DOM 表示应用程序的 UI。每当应用程序 UI 的状态发生更改时，DOM 都会更新以表示该更改。经常操纵 DOM 会影响性能，使其变慢。性能明显优于真正的 DOM。虚拟 DOM 只是 DOM 的虚拟表示。 每次应用程序的状态发生变化时，都会更新虚拟 DOM 而不是真正的 DOM

将新元素添加到 UI 时，将创建一个表示为树的虚拟 DOM。每个元素都是此树上的一个节点。如果这些元素中的任何一个的状态发生更改，则会创建一个新的虚拟 DOM 树。然后将此树与先前的虚拟 DOM 树进行比较或“区分”。完成此操作后，虚拟 DOM 会计算出对真实 DOM 进行这些更改的最佳方法。这确保了对真实 DOM 的操作最少。 因此，降低了更新真实 DOM 的性能成本。

标记更改的节点，然后计算虚拟 DOM 树的先前版本与当前虚拟 DOM 树之间的差异。整个父子树将重新呈现，将此更新的树批量更新为实际 DOM

### React 渲染
render() 函数是创建 React 元素树的入口点。当组件中的状态或属性更新时，render() 将返回不同的 React 元素树。如果在组件中使用 setState（更新数据），React 会立即检测到状态变化并重新渲染组件。
React 遵循批量更新机制来更新真实的 DOM。对实际 DOM 来说，更新是分批发送的，因此更高效的提高性能。重新绘制 UI 是最昂贵的部分，而 React 有效地确保真正的 DOM 只接收批量更新来重新绘制 UI。

使用高效的 diff 算法来比较虚拟 DOM 的版本
确保将批量更新发送到实际 DOM，以重新绘制或重新呈现 UI

### Vue 渲染机制
浏览器的DOM更新，是昂贵的，频繁进行DOM更新性能体验较差。
在 Vue 中，使用 Virtual DOM 。即 用一个原生的 JS 对象去描述一个 DOM 节点（VNode），VNode 是对真实 DOM 的一种抽象描述，通过定义标签名、数据、子节点、键值等关键属性来映射到真实 DOM 的渲染。

Virtual DOM 
将目标所需的 UI 通过数据结构“虚拟”地表示出来，保存在内存中，然后将真实的 DOM 与之保持同步
挂载：运行时渲染器将会遍历整个虚拟 DOM 树，并据此构建真实的 DOM 树
更新：对于两个不同的虚拟 DOM 树，渲染器进行遍历找出它们之间的区别，并变化应用到真实的 DOM 上

编译-> 挂载-> 更新
Vue 模板被编译为渲染函数用来返回虚拟 DOM 树，构建及运行时编译完成
运行时渲染器调用渲染函数，遍历返回的虚拟 DOM 树，并基于它创建实际的 DOM 节点。追踪其中所用到的所有响应式依赖
当一个依赖发生变化后，副作用会重新运行，这时候会创建一个更新后的虚拟 DOM 树。运行时渲染器遍历这棵新树，将它与旧树进行比较，然后将必要的更新应用到真实 DOM 上去。

流程：模板-渲染函数-组件状态(数据)-虚拟dom-真实dom
Vue 的编译器会将模板编译成渲染函数，渲染函数生成一个虚拟 DOM 树（Virtual DOM）当数据发生变化时组件状态驱动虚拟 DOM，虚拟 DOM 与实际 DOM 进行高效更新

### 差异性
Vue 和 React 都使用虚拟 DOM 来提高性能，并通过响应式系统来实现数据和视图的绑定。

DOM模板：Vue 使用模板（Template）来定义组件的结构和布局，模板通常以HTML字符串的形式定义。Vue 的编译器将模板编译成渲染函数，最终生成虚拟 DOM。React 使用 JSX（JavaScript XML）来描述组件的结构。JSX 是一种在 JavaScript 中嵌入XML标记的语法，更接近于编写原生JavaScript代码。

渲染函数：Vue 的渲染函数由 Vue 的编译器生成，React 中组件的render方法需要自定义，返回虚拟 DOM 树。开发者需要手动编写虚拟 DOM 结构，通常是使用 JSX

响应式：Vue 的响应式系统是内置的，它允许你在数据发生变化时自动触发组件的重新渲染。Vue会在数据变化时更新虚拟 DOM。React 的响应式系统需要使用setState来通知组件状态变化，然后组件通过render方法生成新的虚拟 DOM。React使用一种"单向数据流"的模式，组件不会直接修改状态，而是通过setState方法进行更新。

diff算法：
vue 通过对比两个新旧dom树。当组件的状态变化时，Vue 会生成一个新的虚拟 DOM 树。然后，Vue 的差异算法会比较新旧虚拟 DOM 树。Vue 的差异算法采用一种双端比较算法，它会同时从新旧虚拟 DOM 树的两端开始比较节点，以找到最小的变化。它会尽量避免深度优先遍历整个树，从而减少比较的次数。

https://juejin.cn/post/6844903607913938951

react 使用逐层遍历dom树对比。当组件的状态变化时，React 会生成一个新的虚拟 DOM 树。然后，React 的差异算法会比较新旧虚拟 DOM 树。从根节点开始逐层比较新旧虚拟 DOM 树，以找到需要更新的节点。对同一层级的子节点，开发者可以通过 key 来确定哪些子元素可以在不同渲染中保持稳定。两个不同类型的组件会产生两棵不同的树形结构。

https://maimai.cn/article/detail?fid=1756966756&efid=O4drb3felJHy47Q9yh3XKA
