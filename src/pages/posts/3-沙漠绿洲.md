---
date: 2023/08/25
---

<img src="https://i.imgs.ovh/i/2023/08/24/64e6ddddee3c8.png" width="800" />

<small>å°é¢å›¾æ¥æºäºé˜¿æ‹‰å–„æ²™æ¼ ğŸœï¸ç»¿æ´²ï¼Œ2å¹´å‰å›¢å»ºå»çš„ï¼Œå²ä¸Šæœ€å¼€å¿ƒçš„ä¸€æ¬¡æ—…è¡Œï¼Œå¿…é¡»è¦è®°å½•ä¸‹ã€‚</small>

**æ»‘æ»‘æ¢¯**
<img src="https://i.imgs.ovh/i/2023/08/24/64e6dde4a39da.png" width="800" />

### æŠ€æœ¯åˆ†äº«

# jså‘å¸ƒè®¢é˜…

## åŸç†
è®¢é˜…è€…æŠŠè‡ªå·±æƒ³è®¢é˜…çš„äº‹ä»¶å¤„ç†å‡½æ•°æ³¨å†Œåˆ°ç»Ÿä¸€çš„è°ƒåº¦ä¸­å¿ƒä¸­ï¼Œå½“å‘å¸ƒè€…å‘è°ƒåº¦ä¸­å¿ƒå‘å¸ƒæ•°æ®æ—¶ï¼Œç”±è°ƒåº¦ä¸­å¿ƒç»Ÿä¸€è°ƒç”¨è®¢é˜…è€…æ³¨å†Œåˆ°è°ƒåº¦ä¸­å¿ƒçš„äº‹ä»¶å¤„ç†å‡½æ•°ã€‚
å½“ä¸€ä¸ªå¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œæ‰€æœ‰ä¾èµ–å®ƒçš„å¯¹è±¡éƒ½å°†å¾—åˆ°é€šçŸ¥å¹¶æ‰§è¡Œç›¸åº”æ“ä½œã€‚

è°ƒåº¦è€…ï¼šç®¡ç†äº‹ä»¶å’Œé€šçŸ¥çš„ä¸­ä»‹
å‘å¸ƒè€…ï¼šemit(eventName[, ...args]): ç”¨äºå‘å¸ƒï¼ˆè§¦å‘ï¼‰æŒ‡å®šçš„äº‹ä»¶ã€‚å¯ä»¥ä¼ é€’äº‹ä»¶åç§°å’Œä¸€äº›å¯é€‰çš„å‚æ•°ï¼Œä»¥ä¾¿åœ¨äº‹ä»¶è¢«è§¦å‘æ—¶ä¼ é€’ç»™äº‹ä»¶å¤„ç†å‡½æ•°ã€‚
è®¢é˜…è€…ï¼šon(eventName, listener): ç”¨äºè®¢é˜…ï¼ˆç›‘å¬ï¼‰æŒ‡å®šçš„äº‹ä»¶ã€‚å½“äº‹ä»¶è¢«è§¦å‘æ—¶ï¼Œå·²æ³¨å†Œçš„ç›‘å¬å™¨listenerå‡½æ•°ä¼šè¢«è°ƒç”¨ã€‚å¯ä»¥ä¸ºåŒä¸€ä¸ªäº‹ä»¶åç§°æ³¨å†Œå¤šä¸ªç›‘å¬å™¨ã€‚


## æ‰‹å†™å‘å¸ƒè®¢é˜…
```javascript
// å®ç°â¾ƒå®šä¹‰äº‹ä»¶
// ç¼–å†™â¼€ä¸ªç®€å•çš„â¾ƒå®šä¹‰äº‹ä»¶å¤„ç†å™¨
// 1. å…·å¤‡ on â½…æ³•ç»‘å®šäº‹ä»¶
// 2. å…·å¤‡ off â½…æ³•è§£ç»‘äº‹ä»¶
class EventEmitter {
    constructor() {
        this.events = {}; // è°ƒåº¦ä¸­å¿ƒ
    }
    // ç›‘å¬å™¨
    on(event, listener) {
        if(this.events[event]) {
            this.events[event].push(listener);
        } else {
            this.events[event] = [listener];
        }
    }
    // è§¦å‘å™¨
    emit(event, ...args) {
        // å…ˆå¤„ç†é€šé…ç¬¦
        if(event === '*') {
            Object.keys(this.events).forEach(key => {
                this.events[key].forEach(listener => {
                    listener(...args);
                });
            });
            return;
        }
        if(this.events[event]) {
            this.events[event].forEach(listener => {
                listener(...args);
            });
        }
    }
    off(event, listener) {
        if(this.events[event] && listener) {
            this.events[event] = this.events[event].filter(l => l !== listener);
        } else {
            delete this.events[event];
        }
    }
}


var emitter = new EventEmitter();

emitter.on('foo', function(e){
    console.log('listening foo event 1', e);
});

emitter.on('foo', function(e){
    console.log('listening foo event 2', e);
});

emitter.on('bar', function(e){
    console.log('listening bar event', e);
});

// // ç›‘å¬å…¨éƒ¨äº‹ä»¶
emitter.on('*', function(e){
    // æ„æ€å°±æ˜¯ä¸ç®¡ä»€ä¹ˆäº‹ä»¶è¢«è§¦å‘ï¼Œéƒ½ä¼šè¢«ç›‘å¬åˆ°
    console.log('listening all events');
});

emitter.emit('foo', {name : 'John'});
emitter.emit('bar', {name : 'Sun'});
emitter.emit('*', {name : 'Sun'}); // å…ˆè§¦å‘ï¼Œåç›‘å¬åˆ°ï¼Œå†æ‰§è¡Œç›‘å¬å›è°ƒ

emitter.off('foo');
```
