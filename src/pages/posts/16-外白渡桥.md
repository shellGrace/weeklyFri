---
date: 2024/07/12
---

<img src="https://i.ibb.co/YWfwhW0/790e2016c9d1f095e6cf5cd8706d513c.jpg" width="800" />

<small>封面图来源于外白渡桥，一个看东方明珠特别的位置，人少较为清静，漫步苏州河畔，有一丝丝的惬意。</small>


## 技术笔记-webpack相关-详解 loader 和 plugin

## loader

loader 用于对模块的源代码进行转换。loader 可以使你在 import 或 加载 模块时预处理文件。
webpack 只能处理 JavaScript 和 JSON 文件，通过配置不同的 loaders，可以扩展 Webpack 处理其他类型的文件

告诉 webpack 编译器(compiler) babel-loader 通过 Babel 转译 JavaScript 文件

```javascript
module: {
    rules: [{ test: /\.txt$/, use: 'raw-loader' }],
 }
```

webpack 对每个 .css 使用 css-loader，以及对所有 .ts 文件使用 ts-loader

```javascript
module.exports = {
  module: {
    rules: [
      { test: /\.css$/, use: 'css-loader' },
      { test: /\.ts$/, use: 'ts-loader' },
    ],
  },
};
```

注意点

- 在 webpack 配置中定义 rules 时，要定义在 module.rules 而不是 rules 中。
- loader 从右到左（或从下到上）地取值(evaluate)/执行(execute)。

### loader 特性

loader 支持链式调用
loader 可以是同步的,也可以是异步的。
插件(plugin)可以为 loader 带来更多特性

### loader 解析

遵循特定的规范进行解析，且 每个 loader 会接收前一个 loader 处理后的输出作为输入，最终输出给下一个 loader

```javascript
module.exports = {
  module: {
    rules: [
    ],
  },
};
```

每次文件系统访问文件都会被缓存，以便于更快触发对同一文件的请求，启用 Watch 模式 则 webpack 将继续监听任何已解析文件的更改

```javascript
module.exports = {
  //...
  watch: true,
};
```

https://webpack.docschina.org/configuration/watch/#watch

JavaScript 文件处理，将现代 JavaScript 语法转换为兼容更旧浏览器的语法。

```javascript
{
     test: /\.js$/,  // 匹配所有以 .js 结尾的文件
     exclude: /node_modules/,  // 排除 node_modules 文件夹
     use: 'babel-loader',  // 使用 babel-loader 处理匹配的文件
   },
```

为同一个文件类型指定多个 loaders，形成一个处理链
这段配置会将 .scss 文件依次通过 sass-loader（将 Sass 转换为 CSS）、css-loader（解析 CSS）、style-loader（将 CSS 插入到 DOM 中）。

```javascript
{
     test: /\.scss$/,  // 匹配所有以 .scss 结尾的文件
     use: ['style-loader', 'css-loader', 'sass-loader'],  // 使用 style-loader 和 css-loader
   },
```

Loaders 可接受 options 进行配置，或在 .babelrc 或 babel.config.js 文件中配置，根据你指定的浏览器兼容性目标自动决定需要的 Babel 插件和 polyfills。babel-loader 会自动读取 babel.config.js 文件中的配置

```javascript
{
  test: /\.js$/,
  exclude: /node_modules/,
  use: {
    loader: 'babel-loader',
    options: {
      presets: ['@babel/preset-env'],
    },
  },
}
```

处理多种文件类型，Webpack 的 loader 系统可以处理多种文件类型，不限于 JavaScript 和 CSS

```javascript
{
  test: /\.(woff|woff2|eot|ttf|otf)$/,
  use: 'file-loader',
}
```

### 编写一个 loader

https://webpack.docschina.org/contribute/writing-a-loader/

## plugin

loader 用于转换某些类型的模块，而插件则可以用于执行范围更广的任务。包括：打包优化，资源管理，注入环境变量
用法：在 webpack 配置中，向 plugins 属性传入一个 new 实例

```javascript
// webpack.config.js
const HtmlWebpackPlugin = require('html-webpack-plugin');
const webpack = require('webpack'); // 用于访问内置插件

module.exports = {
   plugins: [new HtmlWebpackPlugin({ template: './src/index.html' })],
};
```

### 自定义一个 plugin

webpack 插件是一个具有 apply 方法的 JavaScript 对象。apply 方法会被 webpack compiler 调用，并且在 整个 编译生命周期都可以访问 compiler 对象。
pluginName 为驼峰式命名的插件名称

```javascript
const pluginName = 'ConsoleLogOnBuildWebpackPlugin';

class ConsoleLogOnBuildWebpackPlugin {
  apply(compiler) {
    compiler.hooks.run.tap(pluginName, (compilation) => {
      console.log('webpack 构建正在启动！');
    });
  }
}

module.exports = ConsoleLogOnBuildWebpackPlugin;
```
